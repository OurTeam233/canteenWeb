<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--命名空间为全类名-->
<mapper namespace="com.mapper.OrderMapper">
    <resultMap id="OrderResultMapper" type="order">
        <id column="orderId" property="id"/>
        <result column="studentId" property="studentId"/>
        <result column="orderNumber" property="orderNumber"/>
        <result column="orderTime" property="orderTime"/>
        <result column="time" property="time"/>
        <result column="note" property="note"/>
        <result column="totalPrice" property="totalPrice"/>
        <result column="canteen_name" property="canteenName"/>
        <result column="address" property="address"/>
        <collection property="orderDetailsList" ofType="orderDetails">
            <id column="dishesId" property="dishesId"/>
            <result column="name" property="name"/>
            <result column="price" property="price"/>
            <result column="num" property="num"/>
        </collection>
    </resultMap>

    <select id="selectOrderByStudentId" resultMap="OrderResultMapper">
        SELECT o.id    orderId,
               o.orderNumber,
               o.orderTime,
               o.time,
               o.type,
               o.note,
               o.totalPrice,
               d.id    dishesId,
               d.`name`,
               d.price,
               od.num,
               s.canteen_name,
               s.address
        FROM `order` o
                 LEFT JOIN orderdetails od ON od.order_id = o.id
                 LEFT JOIN dishes d ON d.id = od.dishes_id
                 LEFT JOIN store s ON s.id = o.store_id
        WHERE student_id = #{studentId}
    </select>
</mapper>